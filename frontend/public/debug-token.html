<!DOCTYPE html>
<html>
<head>
    <title>Tokenè°ƒè¯•</title>
</head>
<body>
    <h1>Tokenè°ƒè¯•å·¥å…·</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        log('ğŸ” æ£€æŸ¥localStorageä¸­çš„è®¤è¯ä¿¡æ¯...');
        
        // æ£€æŸ¥æ‰€æœ‰localStorageé¡¹
        log('localStorageä¸­çš„æ‰€æœ‰é¡¹:');
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            log(`${key}: ${value}`);
        }
        
        // æ£€æŸ¥auth-storage
        const authStorage = localStorage.getItem('auth-storage');
        if (authStorage) {
            try {
                const parsed = JSON.parse(authStorage);
                log('âœ… auth-storageè§£ææˆåŠŸ:');
                log(JSON.stringify(parsed, null, 2));
                
                const token = parsed.state?.token;
                if (token) {
                    log('âœ… æ‰¾åˆ°token: ' + token.substring(0, 20) + '...');
                } else {
                    log('âŒ æœªæ‰¾åˆ°token');
                }
            } catch (error) {
                log('âŒ auth-storageè§£æå¤±è´¥: ' + error.message);
            }
        } else {
            log('âŒ æœªæ‰¾åˆ°auth-storage');
        }
        
        // æµ‹è¯•tokenè·å–å‡½æ•°
        const getToken = () => {
            const authStorage = localStorage.getItem('auth-storage');
            if (authStorage) {
                try {
                    const { state } = JSON.parse(authStorage);
                    return state?.token;
                } catch (error) {
                    console.error('Failed to parse auth storage:', error);
                }
            }
            return null;
        };
        
        const token = getToken();
        log('\nğŸ” ä½¿ç”¨getTokenå‡½æ•°è·å–çš„ç»“æœ: ' + (token || 'æœªè·å–åˆ°'));
        
        // æµ‹è¯•å¤´åƒä¸Šä¼ è¯·æ±‚æ„å»º
        if (token) {
            log('\nğŸ” æµ‹è¯•å¤´åƒä¸Šä¼ è¯·æ±‚æ„å»º...');
            
            const formData = new FormData();
            const testFile = new Blob(['test'], { type: 'image/png' });
            formData.append('avatar', testFile, 'test.png');
            
            const headers = {
                'Authorization': `Bearer ${token}`
            };
            
            log('è¯·æ±‚å¤´Authorization: ' + headers.Authorization.substring(0, 30) + '...');
            log('âœ… å¤´åƒä¸Šä¼ è¯·æ±‚æ„å»ºæˆåŠŸ');
        }
    </script>
</body>
</html>